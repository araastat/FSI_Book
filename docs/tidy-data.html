<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>4.1 Tidy data | PS_312.utf8</title>
  <meta name="description" content="These are course notes for the FSI course ‘Programming with R’ (PS 312) taught over 3 days">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="4.1 Tidy data | PS_312.utf8" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://www.araastat.com/FSI_Book" />
  
  <meta property="og:description" content="These are course notes for the FSI course ‘Programming with R’ (PS 312) taught over 3 days" />
  <meta name="github-repo" content="araastat/FSI_Book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4.1 Tidy data | PS_312.utf8" />
  
  <meta name="twitter:description" content="These are course notes for the FSI course ‘Programming with R’ (PS 312) taught over 3 days" />
  

<meta name="author" content="Abhijit Dasgupta, PhD">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="sec-data-munging.html">
<link rel="next" href="data-cleaning.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">PS 312</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="reproducibility.html"><a href="reproducibility.html"><i class="fa fa-check"></i>Reproducibility</a></li>
</ul></li>
<li class="part"><span><b>Starting up</b></span></li>
<li class="chapter" data-level="1" data-path="what-is-r.html"><a href="what-is-r.html"><i class="fa fa-check"></i><b>1</b> What is R?</a><ul>
<li class="chapter" data-level="" data-path="a-note-on-coding-and-programming.html"><a href="a-note-on-coding-and-programming.html"><i class="fa fa-check"></i>A note on coding and programming</a><ul>
<li class="chapter" data-level="" data-path="a-note-on-coding-and-programming.html"><a href="a-note-on-coding-and-programming.html#coding"><i class="fa fa-check"></i>Coding</a></li>
<li class="chapter" data-level="" data-path="a-note-on-coding-and-programming.html"><a href="a-note-on-coding-and-programming.html#r-the-language"><i class="fa fa-check"></i>R, the language</a></li>
</ul></li>
<li class="chapter" data-level="1.1" data-path="a-short-introduction-to-r-objects.html"><a href="a-short-introduction-to-r-objects.html"><i class="fa fa-check"></i><b>1.1</b> A short introduction to R objects</a><ul>
<li class="chapter" data-level="1.1.1" data-path="a-short-introduction-to-r-objects.html"><a href="a-short-introduction-to-r-objects.html#objects"><i class="fa fa-check"></i><b>1.1.1</b> Objects</a></li>
<li class="chapter" data-level="1.1.2" data-path="a-short-introduction-to-r-objects.html"><a href="a-short-introduction-to-r-objects.html#extracting-elements-from-objects"><i class="fa fa-check"></i><b>1.1.2</b> Extracting elements from objects</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="r-packages.html"><a href="r-packages.html"><i class="fa fa-check"></i><b>1.2</b> R Packages</a><ul>
<li class="chapter" data-level="" data-path="r-packages.html"><a href="r-packages.html#installing-packages"><i class="fa fa-check"></i>Installing packages</a></li>
<li class="chapter" data-level="1.2.1" data-path="r-packages.html"><a href="r-packages.html#loading-packages-in-r"><i class="fa fa-check"></i><b>1.2.1</b> Loading packages in R</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="r-resources.html"><a href="r-resources.html"><i class="fa fa-check"></i><b>1.3</b> R Resources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="rstudio-your-development-environment-authoring-program.html"><a href="rstudio-your-development-environment-authoring-program.html"><i class="fa fa-check"></i><b>2</b> RStudio, your development environment (authoring program)</a><ul>
<li class="chapter" data-level="" data-path="starting-rstudio.html"><a href="starting-rstudio.html"><i class="fa fa-check"></i>Starting RStudio</a></li>
<li class="chapter" data-level="" data-path="other-panes.html"><a href="other-panes.html"><i class="fa fa-check"></i>Other panes</a></li>
<li class="chapter" data-level="2.1" data-path="workflow.html"><a href="workflow.html"><i class="fa fa-check"></i><b>2.1</b> Rstudio workflow</a></li>
<li class="chapter" data-level="2.2" data-path="rstudio-projects.html"><a href="rstudio-projects.html"><i class="fa fa-check"></i><b>2.2</b> RStudio Projects</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="loading-data-into-r.html"><a href="loading-data-into-r.html"><i class="fa fa-check"></i><b>3</b> Loading data into R</a><ul>
<li class="chapter" data-level="3.1" data-path="finer-control-of-csv-imports.html"><a href="finer-control-of-csv-imports.html"><i class="fa fa-check"></i><b>3.1</b> Finer control of CSV imports</a></li>
<li class="chapter" data-level="3.2" data-path="finer-control-of-excel-imports.html"><a href="finer-control-of-excel-imports.html"><i class="fa fa-check"></i><b>3.2</b> Finer control of Excel imports</a></li>
<li class="chapter" data-level="3.3" data-path="importing-data-from-databases.html"><a href="importing-data-from-databases.html"><i class="fa fa-check"></i><b>3.3</b> Importing data from databases</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="sec-data-munging.html"><a href="sec-data-munging.html"><i class="fa fa-check"></i><b>4</b> Data Munging</a><ul>
<li class="chapter" data-level="4.1" data-path="tidy-data.html"><a href="tidy-data.html"><i class="fa fa-check"></i><b>4.1</b> Tidy data</a><ul>
<li class="chapter" data-level="4.1.1" data-path="tidy-data.html"><a href="tidy-data.html#variable-in-column-names"><i class="fa fa-check"></i><b>4.1.1</b> Variable in column names</a></li>
<li class="chapter" data-level="4.1.2" data-path="tidy-data.html"><a href="tidy-data.html#multiple-variables-in-column-names"><i class="fa fa-check"></i><b>4.1.2</b> Multiple variables in column names</a></li>
<li class="chapter" data-level="4.1.3" data-path="tidy-data.html"><a href="tidy-data.html#variables-stored-in-rows-and-columns"><i class="fa fa-check"></i><b>4.1.3</b> Variables stored in rows and columns</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="data-cleaning.html"><a href="data-cleaning.html"><i class="fa fa-check"></i><b>4.2</b> Data cleaning</a><ul>
<li class="chapter" data-level="" data-path="data-cleaning.html"><a href="data-cleaning.html#exercise"><i class="fa fa-check"></i>Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="cleaning-up-data-types-and-values.html"><a href="cleaning-up-data-types-and-values.html"><i class="fa fa-check"></i><b>4.3</b> Cleaning up data types and values</a></li>
<li class="chapter" data-level="4.4" data-path="other-types-of-cleaning.html"><a href="other-types-of-cleaning.html"><i class="fa fa-check"></i><b>4.4</b> Other types of cleaning</a></li>
<li class="chapter" data-level="4.5" data-path="cleaning-from-excel-files.html"><a href="cleaning-from-excel-files.html"><i class="fa fa-check"></i><b>4.5</b> Cleaning from Excel files</a></li>
<li class="chapter" data-level="4.6" data-path="cleaning-from-excel-files-1.html"><a href="cleaning-from-excel-files-1.html"><i class="fa fa-check"></i><b>4.6</b> Cleaning from Excel files</a><ul>
<li class="chapter" data-level="" data-path="cleaning-from-excel-files-1.html"><a href="cleaning-from-excel-files-1.html#dealing-with-visual-formating-colors"><i class="fa fa-check"></i>Dealing with visual formating (colors)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sec-description.html"><a href="sec-description.html"><i class="fa fa-check"></i><b>5</b> Describing data</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><div class="line-block">PS 312: Programming with R<br />
Course Notes</div></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tidy-data" class="section level2">
<h2><span class="header-section-number">4.1</span> Tidy data</h2>
<p>There is a principle of making data “tidy”, promoted by Dr. Hadley Wickham. This
tidying of data makes computer programs happy, since these data can be most
easily digested. A dataset can be messy or tidy depending on how the rows, columns and tables you’re
using align with observations, variables and types.</p>
<p>The properties of a tidy dataset are:</p>
<ol style="list-style-type: decimal">
<li>Each variable forms a column</li>
<li>Each observation forms a row</li>
<li>Each type of observational unit forms a table.</li>
</ol>
<p>This forms a standardized way to structure a dataset, and so makes it easy for the
analyst to develop standard pipelines.</p>
<p>A dataset can be messy in many many ways. Many of the more common issues are listed below:</p>
<ul>
<li>Column names contain values, not just variable names</li>
<li>Multiple variables are stored in one column</li>
<li>Variables are stored in both rows and columns</li>
<li>Multiple types of observational types are stored in the same table</li>
<li>A single observational unit is stored in multiple tables</li>
</ul>
<p>Sometimes the messier format is better for data entry, but bad for data analyses.</p>
<p>We’ll show a few examples here, but a more detailed discussion is available <a href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html">online</a>.</p>
<p>The workhorse for this tidying activity is the <code>tidyr</code> package, part of the <code>tidyverse</code>
meta-package. We’ll tend to start every analysis by loading the <code>tidyverse</code> package,
so we are covered.</p>
<div id="variable-in-column-names" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Variable in column names</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
pew &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&#39;data/pew.csv&#39;</span>)
<span class="kw">head</span>(pew)</code></pre>
<pre><code>##             religion &lt;$10k $10-20k $20-30k $30-40k $40-50k $50-75k
## 1           Agnostic    27      34      60      81      76     137
## 2            Atheist    12      27      37      52      35      70
## 3           Buddhist    27      21      30      34      33      58
## 4           Catholic   418     617     732     670     638    1116
## 5 Don’t know/refused    15      14      15      11      10      35
## 6   Evangelical Prot   575     869    1064     982     881    1486
##   $75-100k $100-150k &gt;150k Don&#39;t know/refused
## 1      122       109    84                 96
## 2       73        59    74                 76
## 3       62        39    53                 54
## 4      949       792   633               1489
## 5       21        17    18                116
## 6      949       723   414               1529</code></pre>
<p>This dataset has actual data in the column headers, rather than variable names. This
information needs to be captured into a column. We should ideally have 3 columns in this
dataset: religion, income and frequency. We can achieve this using a function called <code>gather</code> which
takes a wide dataset and makes it tall. We will do this by forming a pipeline (think of this as a sentence),
starting with the dataset.</p>
<pre class="sourceCode r"><code class="sourceCode r">pew <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(income, frequency, <span class="op">-</span>religion)</code></pre>
<pre><code>##                    religion             income frequency
## 1                  Agnostic              &lt;$10k        27
## 2                   Atheist              &lt;$10k        12
## 3                  Buddhist              &lt;$10k        27
## 4                  Catholic              &lt;$10k       418
## 5        Don’t know/refused              &lt;$10k        15
## 6          Evangelical Prot              &lt;$10k       575
## 7                     Hindu              &lt;$10k         1
## 8   Historically Black Prot              &lt;$10k       228
## 9         Jehovah&#39;s Witness              &lt;$10k        20
## 10                   Jewish              &lt;$10k        19
## 11            Mainline Prot              &lt;$10k       289
## 12                   Mormon              &lt;$10k        29
## 13                   Muslim              &lt;$10k         6
## 14                 Orthodox              &lt;$10k        13
## 15          Other Christian              &lt;$10k         9
## 16             Other Faiths              &lt;$10k        20
## 17    Other World Religions              &lt;$10k         5
## 18             Unaffiliated              &lt;$10k       217
## 19                 Agnostic            $10-20k        34
## 20                  Atheist            $10-20k        27
## 21                 Buddhist            $10-20k        21
## 22                 Catholic            $10-20k       617
## 23       Don’t know/refused            $10-20k        14
## 24         Evangelical Prot            $10-20k       869
## 25                    Hindu            $10-20k         9
## 26  Historically Black Prot            $10-20k       244
## 27        Jehovah&#39;s Witness            $10-20k        27
## 28                   Jewish            $10-20k        19
## 29            Mainline Prot            $10-20k       495
## 30                   Mormon            $10-20k        40
## 31                   Muslim            $10-20k         7
## 32                 Orthodox            $10-20k        17
## 33          Other Christian            $10-20k         7
## 34             Other Faiths            $10-20k        33
## 35    Other World Religions            $10-20k         2
## 36             Unaffiliated            $10-20k       299
## 37                 Agnostic            $20-30k        60
## 38                  Atheist            $20-30k        37
## 39                 Buddhist            $20-30k        30
## 40                 Catholic            $20-30k       732
## 41       Don’t know/refused            $20-30k        15
## 42         Evangelical Prot            $20-30k      1064
## 43                    Hindu            $20-30k         7
## 44  Historically Black Prot            $20-30k       236
## 45        Jehovah&#39;s Witness            $20-30k        24
## 46                   Jewish            $20-30k        25
## 47            Mainline Prot            $20-30k       619
## 48                   Mormon            $20-30k        48
## 49                   Muslim            $20-30k         9
## 50                 Orthodox            $20-30k        23
## 51          Other Christian            $20-30k        11
## 52             Other Faiths            $20-30k        40
## 53    Other World Religions            $20-30k         3
## 54             Unaffiliated            $20-30k       374
## 55                 Agnostic            $30-40k        81
## 56                  Atheist            $30-40k        52
## 57                 Buddhist            $30-40k        34
## 58                 Catholic            $30-40k       670
## 59       Don’t know/refused            $30-40k        11
## 60         Evangelical Prot            $30-40k       982
## 61                    Hindu            $30-40k         9
## 62  Historically Black Prot            $30-40k       238
## 63        Jehovah&#39;s Witness            $30-40k        24
## 64                   Jewish            $30-40k        25
## 65            Mainline Prot            $30-40k       655
## 66                   Mormon            $30-40k        51
## 67                   Muslim            $30-40k        10
## 68                 Orthodox            $30-40k        32
## 69          Other Christian            $30-40k        13
## 70             Other Faiths            $30-40k        46
## 71    Other World Religions            $30-40k         4
## 72             Unaffiliated            $30-40k       365
## 73                 Agnostic            $40-50k        76
## 74                  Atheist            $40-50k        35
## 75                 Buddhist            $40-50k        33
## 76                 Catholic            $40-50k       638
## 77       Don’t know/refused            $40-50k        10
## 78         Evangelical Prot            $40-50k       881
## 79                    Hindu            $40-50k        11
## 80  Historically Black Prot            $40-50k       197
## 81        Jehovah&#39;s Witness            $40-50k        21
## 82                   Jewish            $40-50k        30
## 83            Mainline Prot            $40-50k       651
## 84                   Mormon            $40-50k        56
## 85                   Muslim            $40-50k         9
## 86                 Orthodox            $40-50k        32
## 87          Other Christian            $40-50k        13
## 88             Other Faiths            $40-50k        49
## 89    Other World Religions            $40-50k         2
## 90             Unaffiliated            $40-50k       341
## 91                 Agnostic            $50-75k       137
## 92                  Atheist            $50-75k        70
## 93                 Buddhist            $50-75k        58
## 94                 Catholic            $50-75k      1116
## 95       Don’t know/refused            $50-75k        35
## 96         Evangelical Prot            $50-75k      1486
## 97                    Hindu            $50-75k        34
## 98  Historically Black Prot            $50-75k       223
## 99        Jehovah&#39;s Witness            $50-75k        30
## 100                  Jewish            $50-75k        95
## 101           Mainline Prot            $50-75k      1107
## 102                  Mormon            $50-75k       112
## 103                  Muslim            $50-75k        23
## 104                Orthodox            $50-75k        47
## 105         Other Christian            $50-75k        14
## 106            Other Faiths            $50-75k        63
## 107   Other World Religions            $50-75k         7
## 108            Unaffiliated            $50-75k       528
## 109                Agnostic           $75-100k       122
## 110                 Atheist           $75-100k        73
## 111                Buddhist           $75-100k        62
## 112                Catholic           $75-100k       949
## 113      Don’t know/refused           $75-100k        21
## 114        Evangelical Prot           $75-100k       949
## 115                   Hindu           $75-100k        47
## 116 Historically Black Prot           $75-100k       131
## 117       Jehovah&#39;s Witness           $75-100k        15
## 118                  Jewish           $75-100k        69
## 119           Mainline Prot           $75-100k       939
## 120                  Mormon           $75-100k        85
## 121                  Muslim           $75-100k        16
## 122                Orthodox           $75-100k        38
## 123         Other Christian           $75-100k        18
## 124            Other Faiths           $75-100k        46
## 125   Other World Religions           $75-100k         3
## 126            Unaffiliated           $75-100k       407
## 127                Agnostic          $100-150k       109
## 128                 Atheist          $100-150k        59
## 129                Buddhist          $100-150k        39
## 130                Catholic          $100-150k       792
## 131      Don’t know/refused          $100-150k        17
## 132        Evangelical Prot          $100-150k       723
## 133                   Hindu          $100-150k        48
## 134 Historically Black Prot          $100-150k        81
## 135       Jehovah&#39;s Witness          $100-150k        11
## 136                  Jewish          $100-150k        87
## 137           Mainline Prot          $100-150k       753
## 138                  Mormon          $100-150k        49
## 139                  Muslim          $100-150k         8
## 140                Orthodox          $100-150k        42
## 141         Other Christian          $100-150k        14
## 142            Other Faiths          $100-150k        40
## 143   Other World Religions          $100-150k         4
## 144            Unaffiliated          $100-150k       321
## 145                Agnostic              &gt;150k        84
## 146                 Atheist              &gt;150k        74
## 147                Buddhist              &gt;150k        53
## 148                Catholic              &gt;150k       633
## 149      Don’t know/refused              &gt;150k        18
## 150        Evangelical Prot              &gt;150k       414
## 151                   Hindu              &gt;150k        54
## 152 Historically Black Prot              &gt;150k        78
## 153       Jehovah&#39;s Witness              &gt;150k         6
## 154                  Jewish              &gt;150k       151
## 155           Mainline Prot              &gt;150k       634
## 156                  Mormon              &gt;150k        42
## 157                  Muslim              &gt;150k         6
## 158                Orthodox              &gt;150k        46
## 159         Other Christian              &gt;150k        12
## 160            Other Faiths              &gt;150k        41
## 161   Other World Religions              &gt;150k         4
## 162            Unaffiliated              &gt;150k       258
## 163                Agnostic Don&#39;t know/refused        96
## 164                 Atheist Don&#39;t know/refused        76
## 165                Buddhist Don&#39;t know/refused        54
## 166                Catholic Don&#39;t know/refused      1489
## 167      Don’t know/refused Don&#39;t know/refused       116
## 168        Evangelical Prot Don&#39;t know/refused      1529
## 169                   Hindu Don&#39;t know/refused        37
## 170 Historically Black Prot Don&#39;t know/refused       339
## 171       Jehovah&#39;s Witness Don&#39;t know/refused        37
## 172                  Jewish Don&#39;t know/refused       162
## 173           Mainline Prot Don&#39;t know/refused      1328
## 174                  Mormon Don&#39;t know/refused        69
## 175                  Muslim Don&#39;t know/refused        22
## 176                Orthodox Don&#39;t know/refused        73
## 177         Other Christian Don&#39;t know/refused        18
## 178            Other Faiths Don&#39;t know/refused        71
## 179   Other World Religions Don&#39;t know/refused         8
## 180            Unaffiliated Don&#39;t know/refused       597</code></pre>
<p>Let’s parse this out. First we see this new operator <code>%&gt;%</code>, which you can think of as the word “then”.
So we start with the dataset <code>pew</code>, “then” we gather its columns into two columns, <code>income</code> and <code>frequency</code>.
We don’t want the <code>religion</code> column to be part of this operation, so we “minus” it out, which says, don’t do this
<code>gather</code> operation on the <code>religion</code> column, but use everything else. The <code>religion</code> column gets repeated as needed.</p>
<blockquote>
<p>The <code>%&gt;%</code> operator can be easily typed in RStudio using the shortcut Ctrl-Shift-M (Cmd-Shift-M on a Mac)</p>
</blockquote>
<p>This is now a tidy dataset, since each column is a single variable, each row is a single observation</p>
</div>
<div id="multiple-variables-in-column-names" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Multiple variables in column names</h3>
<pre class="sourceCode r"><code class="sourceCode r">tb &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&#39;data/tb.csv&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()
<span class="kw">head</span>(tb)</code></pre>
<pre><code>## # A tibble: 6 x 22
##   iso2   year   m04  m514  m014 m1524 m2534 m3544 m4554 m5564   m65    mu
##   &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1 AD     1989    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
## 2 AD     1990    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
## 3 AD     1991    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
## 4 AD     1992    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
## 5 AD     1993    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
## 6 AD     1994    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
## # … with 10 more variables: f04 &lt;int&gt;, f514 &lt;int&gt;, f014 &lt;int&gt;,
## #   f1524 &lt;int&gt;, f2534 &lt;int&gt;, f3544 &lt;int&gt;, f4554 &lt;int&gt;, f5564 &lt;int&gt;,
## #   f65 &lt;int&gt;, fu &lt;int&gt;</code></pre>
<p>Notice that the column names contain both sex and age group data. First we’ll <code>gather</code>
the sex/age columns, as before. Note that there are many missing values in this dataset. These
are denoted in R by <code>NA</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">tb <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(sex_age, n, <span class="op">-</span>iso2, <span class="op">-</span>year, <span class="op">-</span>fu)</code></pre>
<pre><code>## # A tibble: 109,611 x 5
##    iso2   year    fu sex_age     n
##    &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;int&gt;
##  1 AD     1989    NA m04        NA
##  2 AD     1990    NA m04        NA
##  3 AD     1991    NA m04        NA
##  4 AD     1992    NA m04        NA
##  5 AD     1993    NA m04        NA
##  6 AD     1994    NA m04        NA
##  7 AD     1996    NA m04        NA
##  8 AD     1997    NA m04        NA
##  9 AD     1998    NA m04        NA
## 10 AD     1999    NA m04        NA
## # … with 109,601 more rows</code></pre>
<p>Since there are a lot of missing values here, we can drop them in the above step by adding an option.</p>
<pre class="sourceCode r"><code class="sourceCode r">tb <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(sex_age, n, <span class="op">-</span>iso2, <span class="op">-</span>year, <span class="op">-</span>fu, <span class="dt">na.rm=</span>T)</code></pre>
<pre><code>## # A tibble: 35,478 x 5
##    iso2   year    fu sex_age     n
##    &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;int&gt;
##  1 AD     2005     0 m04         0
##  2 AD     2006     0 m04         0
##  3 AD     2008     0 m04         0
##  4 AE     2006    NA m04         0
##  5 AE     2007    NA m04         0
##  6 AE     2008     0 m04         0
##  7 AG     2007    NA m04         0
##  8 AL     2005     0 m04         0
##  9 AL     2006     0 m04         1
## 10 AL     2007     0 m04         0
## # … with 35,468 more rows</code></pre>
<p>We can now use the function <code>separate</code> to separate the data in the <code>sex_age</code> column into sex and age. In this
case we have have the data in a fixed width format (the 1st element is the sex data), so we can use that:</p>
<pre class="sourceCode r"><code class="sourceCode r">tb <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(sex_age, n, <span class="op">-</span>iso2, <span class="op">-</span>year, <span class="op">-</span>fu, <span class="dt">na.rm=</span>T) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">separate</span>(sex_age, <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>,<span class="st">&quot;age&quot;</span>), <span class="dt">sep=</span><span class="dv">1</span>)</code></pre>
<pre><code>## # A tibble: 35,478 x 6
##    iso2   year    fu sex   age       n
##    &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
##  1 AD     2005     0 m     04        0
##  2 AD     2006     0 m     04        0
##  3 AD     2008     0 m     04        0
##  4 AE     2006    NA m     04        0
##  5 AE     2007    NA m     04        0
##  6 AE     2008     0 m     04        0
##  7 AG     2007    NA m     04        0
##  8 AL     2005     0 m     04        0
##  9 AL     2006     0 m     04        1
## 10 AL     2007     0 m     04        0
## # … with 35,468 more rows</code></pre>
<p>If the data was separated by a symbol, like <code>_</code>, we would use <code>sep = &quot;_&quot;</code> instead.</p>
</div>
<div id="variables-stored-in-rows-and-columns" class="section level3">
<h3><span class="header-section-number">4.1.3</span> Variables stored in rows and columns</h3>
<pre class="sourceCode r"><code class="sourceCode r">weather &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&#39;data/weather.csv&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()
weather</code></pre>
<pre><code>## # A tibble: 22 x 35
##    id     year month element    d1    d2    d3    d4    d5    d6    d7
##    &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 MX17…  2010     1 tmax       NA  NA    NA      NA  NA      NA    NA
##  2 MX17…  2010     1 tmin       NA  NA    NA      NA  NA      NA    NA
##  3 MX17…  2010     2 tmax       NA  27.3  24.1    NA  NA      NA    NA
##  4 MX17…  2010     2 tmin       NA  14.4  14.4    NA  NA      NA    NA
##  5 MX17…  2010     3 tmax       NA  NA    NA      NA  32.1    NA    NA
##  6 MX17…  2010     3 tmin       NA  NA    NA      NA  14.2    NA    NA
##  7 MX17…  2010     4 tmax       NA  NA    NA      NA  NA      NA    NA
##  8 MX17…  2010     4 tmin       NA  NA    NA      NA  NA      NA    NA
##  9 MX17…  2010     5 tmax       NA  NA    NA      NA  NA      NA    NA
## 10 MX17…  2010     5 tmin       NA  NA    NA      NA  NA      NA    NA
## # … with 12 more rows, and 24 more variables: d8 &lt;dbl&gt;, d9 &lt;lgl&gt;,
## #   d10 &lt;dbl&gt;, d11 &lt;dbl&gt;, d12 &lt;lgl&gt;, d13 &lt;dbl&gt;, d14 &lt;dbl&gt;, d15 &lt;dbl&gt;,
## #   d16 &lt;dbl&gt;, d17 &lt;dbl&gt;, d18 &lt;lgl&gt;, d19 &lt;lgl&gt;, d20 &lt;lgl&gt;, d21 &lt;lgl&gt;,
## #   d22 &lt;lgl&gt;, d23 &lt;dbl&gt;, d24 &lt;lgl&gt;, d25 &lt;dbl&gt;, d26 &lt;dbl&gt;, d27 &lt;dbl&gt;,
## #   d28 &lt;dbl&gt;, d29 &lt;dbl&gt;, d30 &lt;dbl&gt;, d31 &lt;dbl&gt;</code></pre>
<p>Here, for each year and month, the data for each day of the month is stored in columns. For each
day, two values are noted – the max (<code>tmax</code>) and min (<code>tmin</code>) temperature that day, stored as rows.</p>
<p>We start by gathering the extra columns as before:</p>
<pre class="sourceCode r"><code class="sourceCode r">weather <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(day, temp, d1<span class="op">:</span>d31)</code></pre>
<pre><code>## # A tibble: 682 x 6
##    id       year month element day    temp
##    &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt;
##  1 MX17004  2010     1 tmax    d1       NA
##  2 MX17004  2010     1 tmin    d1       NA
##  3 MX17004  2010     2 tmax    d1       NA
##  4 MX17004  2010     2 tmin    d1       NA
##  5 MX17004  2010     3 tmax    d1       NA
##  6 MX17004  2010     3 tmin    d1       NA
##  7 MX17004  2010     4 tmax    d1       NA
##  8 MX17004  2010     4 tmin    d1       NA
##  9 MX17004  2010     5 tmax    d1       NA
## 10 MX17004  2010     5 tmin    d1       NA
## # … with 672 more rows</code></pre>
<blockquote>
<p>Here’s a new notation – <code>d1:d31</code>. This means all columns starting at <code>d1</code> and ending at <code>d31</code>. This notation
is originally from creating sequences of numbers. See what happens if you type <code>1:30</code> in the console.</p>
</blockquote>
<p>Now, for each date, we have two <em>rows</em> of data. These need to be two <em>columns</em> of data. So we need to do the
reverse operation from <code>gather</code>. This is called <code>spread</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">weather <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(date, temp, d1<span class="op">:</span>d31) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">spread</span>(element, temp)</code></pre>
<pre><code>## # A tibble: 341 x 6
##    id       year month date   tmax  tmin
##    &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 MX17004  2010     1 d1       NA    NA
##  2 MX17004  2010     1 d10      NA    NA
##  3 MX17004  2010     1 d11      NA    NA
##  4 MX17004  2010     1 d12      NA    NA
##  5 MX17004  2010     1 d13      NA    NA
##  6 MX17004  2010     1 d14      NA    NA
##  7 MX17004  2010     1 d15      NA    NA
##  8 MX17004  2010     1 d16      NA    NA
##  9 MX17004  2010     1 d17      NA    NA
## 10 MX17004  2010     1 d18      NA    NA
## # … with 331 more rows</code></pre>
<p>We tell <code>spread</code> which column should form column names and which should provide the data for the columns.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sec-data-munging.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-cleaning.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["PS_312.pdf"],
"toc": {
"collapse": "subsection"
},
"toolbar": {
"position": "static"
},
"search": true,
"scroll_highlight": true
});
});
</script>

</body>

</html>
